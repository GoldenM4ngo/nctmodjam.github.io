campaignTrail_temp.election_json = JSON.parse("[{\"model\": \"campaign_trail.election\", \"pk\": 9, \"fields\": {\"year\": 1952, \"summary\": \"<p>March 1952: In a somewhat unexpected move, Stalin made the Western allies an offer, the so called Stalin note - Germany could reunify and have free elections, if it stays neutral and abides by some other rules. Though not everyone trusted this offer to be sincere - then-chancellor Adenauer was especially sceptical - the fact that Stalin had allowed free elections in several other Easter European countries tipped the scales towards the Western allies accepting the offer. Now, Germany is about to be reunified, an event that is hailed as 'the fall of the iron curtain' and 'the end of this short, cold war' around the globe. Before the reunification can come into effect, all of Germany needs to elect a constitutional assembly and work out a constitution that is acceptable for the Federal Republic, the Democratic Republic and the German people - not an easy task. </p>\", \"image_url\": \"https://www.kas.de/o/adaptive-media/image/802337/hd-resolution/7_media_object_file_104692.jpg\", \"winning_electoral_vote_number\": 368, \"advisor_url\": \"https://i.ibb.co/MMkmQk2/advisors.jpg\", \"recommended_reading\": \"\", \"has_visits\": 1, \"no_electoral_majority_image\": \"/static/images/2012-no-majority.jpg\"}}]");
campaignTrail_temp.candidate_json = JSON.parse("[{\"model\": \"campaign_trail.candidate\", \"pk\": 77, \"fields\": {\"first_name\": \"\", \"last_name\": \"SAVD\", \"election\": 9, \"party\": \"Socialist Alliance for a United Germany\", \"state\": \"-\", \"priority\": 1, \"description\": \"<li><b>Abbreviation: SAVD</b></li><li><b>Name: Socialist Alliance for a United Germany</b></li><p>The SAVD is an alliance formed by the East German SED, the West German KPD and the West German SPD - though a lot of members of the latter who are critical of the alliance have defected to the GVP. Broadly, the alliance advocates for uniting Germany as soon as possible and forming a socialist state. While nominally, the Alliance has declared their support for free and fair elections, observers are still wary that they want to turn the new Germany into a one-party state like the German Democratic Republic. Their idea that the East German constitution should be used as a template for the new all-German constitution is fueling these fears.</p><p>Unsurprisingly, the Alliance strongest areas are in East Germany, were the SED has near-total control over the electoral process. However, they are also making inroads among West German workers and people in favour of a quick unification. Their support for accepting the current borders of East Germany and making no moves towards getting back the land beyond the Oder and Neisse makes them unpopular among refugees from these areas. Upper-class voters are naturally also alarmed by the prospect of socialists writing the new constitution.</p>\", \"color_hex\": \"#610129\", \"secondary_color_hex\": \"#77797D\", \"is_active\": 1, \"image_url\": \"https://www.hdg.de/lemo/img_hd/bestand/objekte/geteiltesdeutschland/1951_gesamtdeutsche-beratung_plakat_1991-4-038.jpg\", \"electoral_victory_message\": \" \", \"electoral_loss_message\": \" \", \"no_electoral_majority_message\": \"\", \"description_as_running_mate\": \"\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 78, \"fields\": {\"first_name\": \"\",  \"last_name\": \"GVP\", \"election\": 9, \"party\": \"All-German Peoples' Party\", \"state\": \"-\", \"priority\": 2, \"description\": \"<p><li><b>Abbreviation: GVP</b></li><li><b>Name: All-German Peoples' Party</b></li><p>The All-German Peoples' Party was reacted in reaction of Adenauer's refusal to consider the Stalin note. This lead to a political crisis in the young Federal Republic, the fall of Adenauer, and the election of Gustav Heinemann as chancellor. The party is made up of former CDU members that haven't followed Adenauer, supported by some smaller parties and the part of the SPD that is wary of cooperating with the East German SED.</p><p> Similarly to the Alliance, they are in favour of the unification, though they are a bit more cautious, acknowledging that unification only makes sense if the constitution is satisfactory. They also call for a unification of all German lands, including the ones that became part of Poland in 1945 and the Saar area. Economically, they prefer a social market economy, but want to sidestep that question in the constitution. They are stronger in West Germany outside of North Rhine-Westphalia and Rhineland-Palatine - these states are Adenauer's power base. In the East, they poll in second place, far behind the Alliance.</p>\", \"color_hex\": \"#03540b\", \"secondary_color_hex\": \"#F5878F\", \"is_active\": 1, \"image_url\": \"https://www.dhm.de/archiv/ausstellungen/erf/images/raeume/deutwest/Bild12g.JPG\", \"electoral_victory_message\": \"\", \"electoral_loss_message\": \"\", \"no_electoral_majority_message\": \"\", \"description_as_running_mate\": \"\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 79, \"fields\": {\"first_name\": \"\", \"last_name\": \"Zentrum\", \"election\": 9, \"party\": \"Zentrum\", \"state\": \"-\", \"priority\": 3, \"description\": \"'\", \"color_hex\": \"#000000\", \"secondary_color_hex\": \"#8FDB8F\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/tQmtGBz/Greens.png\", \"electoral_victory_message\": \"\", \"electoral_loss_message\": \"\", \"no_electoral_majority_message\": \"\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 303, \"fields\": {\"first_name\": \"\", \"last_name\": \"FDP\", \"election\": 9, \"party\": \"Free Democratic Party\", \"state\": \"-\", \"priority\": 4, \"description\": \"'\", \"color_hex\": \"#F5F518\", \"secondary_color_hex\": \"#FAFA9B\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}},{\"model\": \"campaign_trail.candidate\", \"pk\": 304, \"fields\": {\"first_name\": \"\", \"last_name\": \"BHE\", \"election\": 9, \"party\": \"Bund der Heimatvertriebenen und Entrechteten\", \"state\": \"-\", \"priority\": 5, \"description\": \"'\", \"color_hex\": \"#a39341\", \"secondary_color_hex\": \"#F595ED\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}},{\"model\": \"campaign_trail.candidate\", \"pk\": 306, \"fields\": {\"first_name\": \"\", \"last_name\": \"Others\", \"election\": 9, \"party\": \"Minor Parties\", \"state\": \"-\", \"priority\": 7, \"description\": \"'\", \"color_hex\": \"#807E7F\", \"secondary_color_hex\": \"#C9C7C9\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 307, \"fields\": {\"first_name\": \"Otto\", \"last_name\": \"Grotewohl\", \"election\": 9, \"party\": \"SED\", \"state\": \"Berlin\", \"priority\": 8, \"description\": \"\", \"color_hex\": \"#0000FF\", \"secondary_color_hex\": \"#90C0FF\", \"is_active\": 0, \"image_url\": \"https://i.ibb.co/2dV8Ys8/Grotewohl.jpg\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Otto Grotewohl is the current Prime Minister of the GDR, the East German state. Unlike most of the political elite, he was a member of the SPD before it and the KPD were merged to the SED. As such, choosing him as candidate shows some openness towards moderation within your Alliance.</p><p>However, Walther Ulbricht still holds the real power in the GDR and the SED. He's made it clear to Grotewohl that he can say whatever he needs to win this election and win over West German voters. After all, only with a solid socialist majority in the constitutional assembly a constitution that is acceptable to Ulbricht can be crafted.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 310, \"fields\": {\"first_name\": \"Gustav\", \"last_name\": \"Heinemann\", \"election\": 9, \"party\": \"GVP\", \"state\": \"North Rhine-Westphalia\", \"priority\": 11, \"description\": \"'\", \"color_hex\": \"#FF0000\", \"secondary_color_hex\": \"#FFA0A0\", \"is_active\": 0, \"image_url\": \"https://www.zitate.eu/imagecache/6/6/9/c/a/669ca0a2190f25fb3aa647939adac89ad6b57211.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p><b>Currently unplayable</b></p><p>Heinemann, a former member of the CDU, was one of the strongest and most prominent advocates of accepting the Stalin note in West Germany. As chancellor since the fall of Adenauer, he's in a strong position, despite his party only having been founded a few months ago.</p><p>During the election campaign, he has to balance his fragile alliance - if he is too sceptical of unification, he will lose voters to the SAVD which promises a quick reunification. If, on the other hand, he pushes for unification above all else, Adenauer and his allies will attack him for selling out all of Germany to the East.</p>\", \"candidate_score\": 0.0}}]");
campaignTrail_temp.running_mate_json = JSON.parse("[{\"model\": \"campaign_trail.running_mate\", \"pk\": 47, \"fields\": {\"candidate\": 77, \"running_mate\": 307}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 78, \"running_mate\": 310}}]");
campaignTrail_temp.opponents_default_json = JSON.parse("[{\"election\": 9, \"candidates\": [77, 78, 79, 303, 304, 306]}]");
campaignTrail_temp.opponents_weighted_json = JSON.parse("[{\"election\": 9, \"candidates\": [77, 78, 79, 303, 304, 306]}]");
campaignTrail_temp.global_parameter_json = JSON.parse("[{\"model\": \"campaign_trail.global_parameter\", \"pk\": 1, \"fields\": {\"vote_variable\": 1.125, \"max_swing\": 0.12, \"start_point\": 0.94, \"candidate_issue_weight\": 10.0, \"running_mate_issue_weight\": 0.0, \"issue_stance_1_max\": -0.81, \"issue_stance_2_max\": -0.3, \"issue_stance_3_max\": -0.125, \"issue_stance_4_max\": 0.125, \"issue_stance_5_max\": 0.3, \"issue_stance_6_max\": 0.71, \"global_variance\": 0.01, \"state_variance\": 0.005, \"question_count\": 7, \"default_map_color_hex\": \"#C9C9C9\", \"no_state_map_color_hex\": \"#999999\"}}]");
campaignTrail_temp.candidate_dropout_json = JSON.parse("[{\"model\": \"campaign_trail.candidate_dropout\", \"pk\": 1, \"fields\": {\"candidate\": 36, \"affected_candidate\": 18, \"probability\": 1.0}}]");
campaignTrail_temp.temp_election_list = [{"id": 9, "year": 1952, "is_premium": 0, "display_year": "1952DE"}];
campaignTrail_temp.show_premium = true;
campaignTrail_temp.premier_ab_test_version = -1;
campaignTrail_temp.credits = 'u/Vilvilea';
nct_stuff.themes[nct_stuff.selectedTheme].coloring_title = "#0d0c0c"
nct_stuff.themes[nct_stuff.selectedTheme].coloring_window = "#ded00b"
$("#game_window")[0].style.backgroundColor = "#ded00b"
$("#game_window")[0].style.borderColor = "#ded00b"
document.getElementsByClassName("game_header")[0].style.backgroundColor = nct_stuff.themes[nct_stuff.selectedTheme].coloring_title
$(".container")[0].style.backgroundColor = "#b80404"
document.body.background = "https://www.tip-berlin.de/wp-content/uploads/2020/11/imago0071450823h.jpg"
document.body.style.backgroundRepeat = "no-repeat";
document.body.style.backgroundSize = "cover";
document.getElementById("header").src = "https://media.discordapp.net/attachments/1120451106749816846/1120750399406751814/GermanColor.jpg";

quotes = [`„Es gibt schwierige Vaterländer. Eines davon ist Deutschland. Aber es ist unser Vaterland.“ - Gustav Heinemann`,]
customquote = quotes[Math.floor((Math.random() * quotes.length))]

corrr="\n<h2>NEUE WAHLKAMPF-TOUR</h2><font id='wittyquote' size='4' color='white'><em>" + customquote + "</em></font>"

var element = document.getElementById('my-invisible-element');
if (!element) {

 $("#game_start").click((event) => {
    event.preventDefault();
    $("#election_id_button").click((event) => {
        event.preventDefault();
               musicMode()
})
  })
musicMode = () => {
    $("#music_player")[0].children[0].style.display = "none"
    $("#music_player")[0].children[1].style.display = "none"
    document.getElementById("modLoadReveal").style.display = "none"
    document.getElementById("modloaddiv").style.display = "none"
    musicBox = document.getElementById("music_player")
    musicBox.style.display = ""
    var trackSel;
    e = campaignTrail_temp
    e.selectedSoundtrack = 0
    toTime = (seconds) => {
        var date = new Date(null);
        date.setSeconds(seconds);
        return date.toISOString().substr(11, 8);
    }
    generateTime = () => {
        // Get the audio element
        var audio = document.getElementById("campaigntrailmusic");
        timeTracker = document.createElement("div");
        timeTracker.style = `
  text-align:left;
  border-style:solid;
  border-width:3px;
  height:150px;
  width:200px;
  background-color:#999999;
  float:right;
  padding: 10px;
  `
        $("#trackSelParent")[0].prepend(timeTracker);
        $("#trackSelParent")[0].prepend(document.createElement("br"));
        var positionDisplay = document.createElement("gg");
        positionDisplay.id = "position-display";
        var timeSlider = document.createElement("input");
        timeSlider.type = "range";
        timeSlider.min = 0;
        timeSlider.max = 1;
        timeSlider.step = 0.001;
        timeSlider.value = 0;
        timeSlider.style.width = "200px";
        timeSlider.id = "time-slider";
        var pausePlay = document.createElement("button");
        pausePlay.id = "position-display";
        pausePlay.innerHTML = "<b>Pause</b>"
        pausePlay.style.width = "100%";
        pausePlay.addEventListener("click", event => {
            event.preventDefault();
            updatePositionDisplay();
            let audio = document.getElementById("campaigntrailmusic");
            if (audio.paused) {
                audio.play();
                event.target.innerHTML = "<b>Pause</b>";
                return;
            }
            audio.pause();
            event.target.innerHTML = "<b>Play</b>";
            return;
        })
        var volumeLabel = document.createElement("gg");
        volumeLabel.id = "volume-label";
        volumeLabel.innerHTML = "<br><b>Volume: </b>"
        var volumeSlider = document.createElement("input");
        volumeSlider.type = "range";
        volumeSlider.min = 0;
        volumeSlider.max = 1;
        volumeSlider.step = 0.001;
        volumeSlider.value = 0;
        volumeSlider.style.width = "200px";
        volumeSlider.id = "volume-slider";
        volumeSlider.value = audio.volume;
        timeTracker.appendChild(pausePlay);
        timeTracker.appendChild(document.createElement("br"));
        timeTracker.appendChild(document.createElement("br"));
        timeTracker.appendChild(positionDisplay);
        timeTracker.appendChild(timeSlider);
        timeTracker.appendChild(volumeLabel);
        timeTracker.appendChild(volumeSlider);
        updatePositionDisplay();
        function updatePositionDisplay() {
            positionDisplay.innerHTML = "<b>Time:</b> " + toTime(audio.currentTime) + "<br>";
            timeSlider.value = audio.duration ? audio.currentTime / audio.duration : 0;
        }
        function changeTime() {
            positionDisplay.innerHTML = "<b>Time:</b> " + toTime(audio.currentTime) + "<br>";
            audio.currentTime = timeSlider.value * audio.duration;
        }
        updateVolume = event => {
            audio.volume = event.target.value;
        }
        setInterval(updatePositionDisplay, 1000);
        timeSlider.addEventListener("input", changeTime);
        volumeSlider.addEventListener("input", updateVolume)
    }
    function newMusicPlayer() {
        trackSel = document.createElement("div");
        trackSel.id = "trackSelParent"
        let z = `<br><br><br><br><br><br><br><br><br><br><div id='trackSel' style="text-align:left;border-style:solid;border-width:3px;overflow-y: scroll;overflow-x: hidden;height:200px; width:400px;background-color:#999999;float:right;">`
        z += `<b><select id='selectSoundtrack'><option value='` + soundtracks[e.selectedSoundtrack].name + `'>` + soundtracks[e.selectedSoundtrack].name + "</option>"
        for (i in soundtracks) {
            if (soundtracks[e.selectedSoundtrack] != soundtracks[i]) {
                z += `<option value='` + soundtracks[i].name + `'>` + soundtracks[i].name + `</option>`
            }
        }
        z += `</select></b><br><br>`
            // <label><input type="radio" name="option" value="option1">Option 1</label><br>
        for (i in soundtracks[e.selectedSoundtrack].tracklist) {
            let a = soundtracks[e.selectedSoundtrack].tracklist[i]
            let b = `<label><input class="trackSelector" type="radio" name="trackSelector" value="` + i + `">` + a.name + `</label><br>`
            z += b
        }
        z += "</div><br><br>"
        trackSel.innerHTML = z
        musicBox.appendChild(trackSel);
        Array.from(document.getElementById("trackSel").children).filter(f => {
            return f.tagName == "LABEL"
        }).map(f => f.children[0])[0].checked = true
        soundtrackSelector = document.getElementById("selectSoundtrack")
        soundtrackSelector.onchange = function() {
            for (i in soundtracks) {
                if (soundtracks[i].name == soundtrackSelector.value) {
                    e.selectedSoundtrack = i
                    break
                }
            }
            document.getElementById("trackSelParent").remove()
            newMusicPlayer()
        }
        var matches = document.querySelectorAll('.trackSelector');
        for (match in matches) {
            matches[match].onchange = function() {
                audio = $("#campaigntrailmusic")[0];
                audio.src = soundtracks[e.selectedSoundtrack].tracklist[this.value].url
                audio.currentTime = 0
            }
        }
        musicBox.children[2].loop = false
        musicBox.children[2].src = soundtracks[e.selectedSoundtrack].tracklist[0].url
        musicBox.children[2].onended = function() {
            console.log("next track")
            let selected = Number(document.querySelector('input[name="trackSelector"]:checked').value);
            let newSel = clamp(selected + 1, soundtracks[e.selectedSoundtrack].tracklist.length - 1, 0)
            let buttons = Array.from(document.getElementById("trackSel").children).filter(f => {
                    return f.tagName == "LABEL"
                }).map(f => f.children[0])
                //let selectedIndex = buttons.map(f=>f.children[0]).map(f=>f.checked)
            buttons[newSel].click()
        }
        for (w = 0; w < 7; w++) {
          document.getElementById("trackSelParent").appendChild(document.createElement("br"))
        }
        generateTime();
    }
    clamp = function(a, max, min, overflow = true) {
        if (overflow) {
            return a > max ? min : a < min ? max : a;
        }
        return a > max ? max : a < min ? min : a;
    }
    var soundtracks = {
        0: {
          name: "For a Socialist Tomorrow",
          tracklist: [
            {
              "name": "Lied der Partei",
              "url": "https://cdn.discordapp.com/attachments/1122524253896589442/1122529162150826094/Lied_der_Partei.mp3"
            },
            {
              "name": "Der heimlich Aufmarsch",
              "url": "https://cdn.discordapp.com/attachments/1122524253896589442/1122529001311834142/Der_heimliche_Aufmarsch.mp3"
            },
            {
              "name": "Auferstanden aus Ruinen (East German Anthem)",
              "url": "https://cdn.discordapp.com/attachments/1122524253896589442/1122528951668064326/Auferstanden_aus_Ruinen.mp3"
            },
            {
              "name": "Die Internationale",
              "url": "https://cdn.discordapp.com/attachments/1122524253896589442/1122529116265140345/Die_Internationale.mp3"
            },
            {
              "name": "Ami go Home",
              "url": "https://cdn.discordapp.com/attachments/1122524253896589442/1122528891916005506/Ami_go_Home.mp3"
            },
            {
              "name": "Der offene Aufmarsch",
              "url": "https://cdn.discordapp.com/attachments/1122524253896589442/1122529058601836615/Der_offene_Aufmarsch.mp3"
            }
        ]
            }
    }
    newMusicPlayer()
  }


function updateHeader() {
  var gameHeader = document.getElementsByClassName("game_header")[0];

  if (gameHeader.getAttribute("id") !== "modifiedHeader") {
    gameHeader.innerHTML = corrr;
    gameHeader.style.backgroundColor = nct_stuff.themes[nct_stuff.selectedTheme].coloring_title;
    gameHeader.setAttribute("id", "modifiedHeader");
  }
}

var headerobserver = new MutationObserver(updateHeader);
headerobserver.observe(document.documentElement, { childList: true, subtree: true });


function updateCandidateForm() {
  formobserver.disconnect();
  const heading = document.querySelector("#candidate_form form h3");

  if (heading) {
    heading.textContent = "Please select your party:";
  }
  formobserver.observe(document.documentElement, { childList: true, subtree: true });
}

var formobserver = new MutationObserver(updateCandidateForm);
formobserver.observe(document.documentElement, { childList: true, subtree: true });

function updateRunningMateForm() {
  runformobserver.disconnect();
  const heading = document.querySelector("#running_mate_form form h3");

  if (heading) {
    heading.textContent = "Please select your candidate:";
  }
  runformobserver.observe(document.documentElement, { childList: true, subtree: true });
}

var runformobserver = new MutationObserver(updateRunningMateForm);
runformobserver.observe(document.documentElement, { childList: true, subtree: true });

function removeCandidateSummary() {
  sumobserver.disconnect();
  const candidateSummary = document.querySelector("#candidate_summary");
  if (candidateSummary) {
    const ulList = candidateSummary.querySelector("ul");
    if (ulList) {
      candidateSummary.removeChild(ulList);
    }
  }
  sumobserver.observe(document.body, {childList: true,subtree: true});
}

var sumobserver = new MutationObserver(removeCandidateSummary);
sumobserver.observe(document.body, {childList: true,subtree: true});

function modifyAllocationForm() {

    alloformobserver.disconnect();
    const form = document.querySelector('form[name="game_type_selection"]');
        if(form){
        const select = form.querySelector('select[name="game_type_id"]');

        // change option value
        const option = select.querySelector('option[value="1"]');
        option.textContent = 'Default (Proportional)';


        var optionToRemove = document.querySelector('option[value="2"]');
        if (optionToRemove) {
          optionToRemove.style.display = 'none';
        }

        // change h3 text
        const h3 = form.querySelector('h3');
        h3.textContent = 'How would you like the seats to be allocated?';
        }
        const opponentSelectionDescription = document.getElementById("opponent_selection_description_window");
        if(opponentSelectionDescription){
        opponentSelectionDescription.innerHTML = `<p><strong>Use a proportional system with additional rules.</strong></p><p>The exact electoral system is yet to be determined. For now, it looks like proportional representation, meaning that roughly 30% of assembly members will come from East German states and 70% from West German ones. Also, a 5% national threshold has been proposed.</p>`;
        }

    alloformobserver.observe(document.body, {childList: true,subtree: true});
}

var alloformobserver = new MutationObserver(modifyAllocationForm);
alloformobserver.observe(document.body, {childList: true,subtree: true});


    var invisibleElement = document.createElement('div');
    invisibleElement.style.display = 'none';
    invisibleElement.id = 'my-invisible-element';
    document.body.appendChild(invisibleElement);
}
